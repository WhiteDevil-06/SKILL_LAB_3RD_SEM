<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Personal Budget Planner — MVP (Firestore)</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase (compat libs for simpler migration) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden>
        <rect width="24" height="24" rx="6" fill="#eef2ff"/>
        <path d="M7 12h10M7 8h10M7 16h6" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      Personal Budget Planner
    </div>

    <!-- Auth controls -->
    <div style="margin-left:auto; display:flex; gap:8px; align-items:center; padding-right:16px">
      <div id="userEmail" class="muted" style="font-size:0.95rem;"></div>
      <button id="authSignUp" class="btn btn-ghost" style="font-size:0.9rem"><a href="signup.html">Sign Up</a></button>
      <button id="authSignIn" class="btn btn-ghost" style="font-size:0.9rem"><a href="login.html">Sign In</a></button>
      <button id="authSignOut" class="btn" style="display:none; font-size:0.9rem">Sign Out</button>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- LEFT: Form + Budgets -->
      <div class="leftcol">
        <div class="card">
          <h2>Add Transaction</h2>
          <form id="txForm">
            <div class="form-grid">
              <div class="form-row">
                <label>
                  <div class="muted">Type</div>
                  <select id="type" required>
                    <option value="expense">Expense</option>
                    <option value="income">Income</option>
                  </select>
                </label>
                <label>
                  <div class="muted">Category</div>
                  <select id="category" required>
                    <!-- fallback categories (JS will also populate these when ready) -->
                    <option value="Salary">Salary</option>
                    <option value="Food">Food</option>
                    <option value="Rent">Rent</option>
                    <option value="Transport">Transport</option>
                    <option value="Shopping">Shopping</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Savings">Savings</option>
                    <option value="Health">Health</option>
                    <option value="Other">Other</option>
                  </select>
                </label>
              </div>

              <label>
                <div class="muted">Amount</div>
                <input id="amount" type="number" step="0.01" required placeholder="e.g., 450.00">
              </label>

              <div class="form-row">
                <label>
                  <div class="muted">Date</div>
                  <input id="date" type="date" required>
                </label>
                <label>
                  <div class="muted">Currency</div>
                  <select id="currency">
                    <option value="INR">INR</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                  </select>
                </label>
              </div>

              <label>
                <div class="muted">Note (optional)</div>
                <textarea id="note" rows="2" placeholder="Lunch with friend..."></textarea>
              </label>

              <div class="form-actions">
                <button class="btn btn-primary" id="saveBtn" type="submit">Add Transaction</button>
                <button class="btn btn-ghost" id="resetBtn" type="button">Reset</button>
                <div style="flex:1"></div>
                <button class="btn" id="exportCSV" type="button">Export CSV</button>
              </div>
            </div>
          </form>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h3>Budgets</h3>
          <div id="budgetList" class="budget-list"></div>

          <hr>

          <form id="budgetForm" class="budget-form">
            <div class="form-row">
              <label>
                <div class="muted">Scope</div>
                <select id="budgetScope">
                  <option value="monthly">Monthly</option>
                  <option value="category">Category</option>
                </select>
              </label>
              <!-- changed to date (day-level) so we can restrict year via JS -->
              <label>
                <div class="muted">Date (choose a day within the month)</div>
                <input id="budgetMonth" type="date">
              </label>
            </div>

            <div class="form-row">
              <label>
                <div class="muted">Category (if category)</div>
                <select id="budgetCategory">
                  <!-- fallback categories -->
                  <option value="Salary">Salary</option>
                  <option value="Food">Food</option>
                  <option value="Rent">Rent</option>
                  <option value="Transport">Transport</option>
                  <option value="Shopping">Shopping</option>
                  <option value="Entertainment">Entertainment</option>
                  <option value="Utilities">Utilities</option>
                  <option value="Savings">Savings</option>
                  <option value="Health">Health</option>
                  <option value="Other">Other</option>
                </select>
              </label>
              <label>
                <div class="muted">Limit</div>
                <input id="budgetLimit" type="number" step="0.01" placeholder="e.g., 10000">
              </label>
            </div>

            <div class="form-actions">
              <button class="btn btn-primary" id="saveBudget" type="button">Save Budget</button>
              <button class="btn btn-ghost" id="clearBudgets" type="button">Clear Budgets</button>
            </div>
          </form>
        </div>
      </div>

      <!-- RIGHT: Summary + Filters + Table + Charts -->
      <div class="rightcol">
        <div class="card">
          <div class="card-head">
            <div>
              <h2>Dashboard</h2>
              <div class="muted small">Overview of your financial health</div>
            </div>
            <div class="controls">
              <select id="filterMonth" class="small"></select>

              <!-- dashboard category filter -->
              <label style="margin:0">
                <select id="filterCategory" class="small">
                  <option value="">All Categories</option>
                  <option value="Salary">Salary</option>
                  <option value="Food">Food</option>
                  <option value="Rent">Rent</option>
                  <option value="Transport">Transport</option>
                  <option value="Shopping">Shopping</option>
                  <option value="Entertainment">Entertainment</option>
                  <option value="Utilities">Utilities</option>
                  <option value="Savings">Savings</option>
                  <option value="Health">Health</option>
                  <option value="Other">Other</option>
                </select>
              </label>

              <input id="searchInput" class="small" placeholder="Search notes or amount">
            </div>
          </div>

          <div class="summary" id="summary">
            <div class="tile card">
              <h3>Total Income</h3>
              <p id="totalIncome">₹0.00</p>
            </div>
            <div class="tile card">
              <h3>Total Expense</h3>
              <p id="totalExpense">₹0.00</p>
            </div>
            <div class="tile card">
              <h3>Balance</h3>
              <p id="balance">₹0.00</p>
            </div>
            <div class="tile card">
              <h3>Savings Rate</h3>
              <p id="savingsRate">0%</p>
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="table-wrap">
            <table id="txTable" class="card">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Category</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th>Note</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="txTbody"></tbody>
            </table>
          </div>

          <div class="charts">
            <div class="card">
              <h3>Category Breakdown</h3>
              <canvas id="pieChart" height="220"></canvas>
            </div>
            <div class="card">
              <h3>Monthly Trend</h3>
              <canvas id="lineChart" height="220"></canvas>
            </div>
          </div>

        </div>
      </div>
    </div>

    <footer class="card">
      Built as an MVP — Firestore sync enabled when signed in. Data is saved locally if not signed in.
    </footer>
  </main>

  <!-- Toast container -->
  <div class="toast" id="toast"></div>

  <!-- App script (includes Firestore integration) -->
  <script src="app.js"></script>
</body>
</html>
